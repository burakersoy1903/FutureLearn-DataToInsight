<!DOCTYPE HTML>
<!-- template for HTML conversion plot -->
<html>

  <head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title> iNZight Plot </title>

      <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css">
      <!-- style sheet -->
      <style>
body {
  padding: 20px;
}

/* layout settings */
.svg-div {
  float: left;
  width: 50%;
  position: relative;
}

.tbl-div {
  float: right;
   width: 50%; /* optional */
   overflow-x: auto;
}

/* attempt to use media queries */
@media (max-width: 700px), (orientation: portrait) {
  .svg-div {
    float: left;
    width: 100%;
  }

  .tbl-div {
    float: left;
    width: 100%;
    overflow-x: auto;
  }
}

#control {
  clear: left;
  background-color: #F4F6F7;
  border: 0.5px #B3B6B7 solid;
  border-radius: 5px;
  padding: 10px;
  margin-right: 10px;
  margin-bottom: 10px;
}

button {
  margin: 5px;
}

p {
  margin-top: 5px;
}

/*** TABLE PROPERTIES ***/
/*totals column  or totals row */
table {
  width: 100% !important;
}

td, th {
  text-align: center;
  word-wrap: break-word;
  font-size: 12px;
}

/* table headings */
.headings {
  font-style: italic;
  font-weight:normal;
  text-decoration: underline;
  text-align: center;
  align: center;
  visibility:visible;
}

/* groups for two way bar plots */
.yGroup, .tc {
  text-align: center;
  font-weight: bold;
}

/*** BUTTONS ***/
#viewTable {
  background-color: #1565C0;
  margin-right: 10px;
}

#reset {
  background-color: rgb(0, 128, 0);
  margin-right: 10px;
}

.Percentage {
  background-color:rgb(0, 0, 255);
  opacity: 0.5;
  margin-left: 10px;
}

.Count {
 background-color: purple;
 opacity: 0.5;
 margin-left: 10px;
}

#form {
  display: inline-table;
  padding: 5px;
}

/* textlabels */
.label {
  font-size: 10;
  fill: black;
  stroke: none;
  fill-opacity: 1;
  text-anchor: middle;
  visibility: inherit;
  font-weight: normal;
}

/* BAR PROPERTIES (for bar charts) */
.bar {
  stroke: none;
  visibility: visible;
  opacity: 1;
}

.bar:hover {
  stroke-width: 50%;
  fill-opacity: 0.5;
}

/* upon selection */
.selected {
  opacity: 1;
  visibility: visible;
}

.none {
  opacity: 0.2;
}

.hidden {
  display: none;
  visibility: hidden;
}

/*highlighting data */
.totalRow, .tabSelect, .select {
  align: center;
  font-weight: bold;
}

.rowSelect {
  display: table-row;
  opacity: 1;
}

/* legend interactions and styling */
.show {
  font-size: 115%;
  fill-opacity: 0.5;
}

.out {
  font-size: 100%;
  fill-opacity: 1;
}

.keyText {
  fill: black;
}

/* for box plots - dot plots, histograms */
.box {
  fill: gray;
  fill-opacity: 0.5;
}

.fillBox {
  fill-opacity: 0.2;
}

/* for dot plots and scatter plots */
.point:hover { /* showPoint */
  fill: currentColor;
  stroke-width: 50%;
  fill-opacity: 1;
}

/* for histograms and hexbins */
.histBar {
  stroke: white;
  stroke-width: 0.25;
}

.hexbin {
  stroke: none;
}

.hexbin:hover, .histBar:hover {
  fill-opacity: 0.5;
}

div.tooltip {
    position: absolute;
    text-align: center;
    padding: 5px;
    z-index: 10;
    opacity: 1;
    visibility: hidden;
    font: 11px sans-serif;
    background: white;
    border: 1px solid lightgray;
    border-radius: 5px;
    pointer-events: none;
}

span {
  font-weight: bold;
}

/* for iNZightMaps */
.selectRegion {
  stroke: darkgray;
  fill: black;
  fill-opacity: 0.5;
}

/* line chart container */
.spark-div {
  width: 100%;
  padding: 10px;
  clear: left;
}

/* lines on the chart */
.spark-line {
  stroke: black;
  fill: none;
  stroke-width: 1.5;
}

.follow-text {
    stroke: white;
    fill: black;
    stroke-width: 0.05;
    font-size: 0.75em;
}

.x-lab, .y-lab, .spark-title {
  text-anchor: center;
}

.x-line {
  stroke: black;
  stroke-width: 0.5;
}

/* time slider */
#control div {
  padding: 10px;
  margin: auto;
}

.slider-div {
  width: 90%;
}

.slider {
  -webkit-appearance: none;
  height: 5px;
  border-radius: 5px;
  background: lightgray;
  width: calc(100% - 30px);
  display: block;
}

/* circle thumb */
.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: black;
  cursor: pointer;
  transition: background 0.15s ease-in-out;
}

.slider-val {
  width: 55px;
  border-radius: 5px;
  color: black;
  background: white;
  border: 0.5px #B3B6B7 solid;
  text-align: center;
  line-height: 10px;
  margin: auto;
}

.slider::-webkit-slider-thumb:hover {
  background: darkgray;
}
      </style>

      <!-- jQuery library -->
    <script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- D3 library -->
    <script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
      <!-- for DT + Bootstrap -->
    <script type = "text/javascript" src ="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"> </script>
    <script type = "text/javascript" charset="utf8" src = "https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
    <script type = "text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  </head>

  <body>
    <div class = "container-fluid" id = "main">
      <div class = "svg-div">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="690px" height="533px" viewBox="0 0 690 533" version="1.1">
  <metadata xmlns:gridsvg="http://www.stat.auckland.ac.nz/~paul/R/gridSVG/">
    <gridsvg:generator name="gridSVG" version="1.6-0" time="2018-04-06 10:38:13"/>
    <gridsvg:argument name="name" value=""/>
    <gridsvg:argument name="exportCoords" value="none"/>
    <gridsvg:argument name="exportMappings" value="none"/>
    <gridsvg:argument name="exportJS" value="none"/>
    <gridsvg:argument name="res" value="96"/>
    <gridsvg:argument name="prefix" value=""/>
    <gridsvg:argument name="addClasses" value="FALSE"/>
    <gridsvg:argument name="indent" value="TRUE"/>
    <gridsvg:argument name="htmlWrapper" value="FALSE"/>
    <gridsvg:argument name="usePaths" value="vpPaths"/>
    <gridsvg:argument name="uniqueNames" value="TRUE"/>
    <gridsvg:separator name="id.sep" value="."/>
    <gridsvg:separator name="gPath.sep" value="::"/>
    <gridsvg:separator name="vpPath.sep" value="::"/>
  </metadata>
  <g transform="translate(0, 533) scale(1, -1)">
    <g id="gridSVG" fill="rgb(255,255,255)" stroke="rgb(0,0,0)" stroke-dasharray="none" stroke-width="1" font-size="16" font-family="Helvetica, Arial, FreeSans, Liberation Sans, Nimbus Sans L, sans-serif" opacity="1" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" stroke-opacity="1" fill-opacity="1" font-weight="normal" font-style="normal">
      <defs>
        <symbol id="gridSVG.pch22" viewBox="-5 -5 10 10" overflow="visible">
          <rect x="-3.32" y="-3.32" width="6.64" height="6.64"/>
        </symbol>
      </defs>
      <g id="container.1" font-size="16">
        <g id="container::VP:TOPlayout.1">
          <g id="container::VP:TOPlayout::GRID.VP.495.1"/>
        </g>
        <g id="container::VP:TOPlayout.2">
          <g id="container::VP:TOPlayout::GRID.VP.496.1">
            <g id="inz-main-title.1">
              <g id="inz-main-title.1.1" transform="translate(345, 518)" stroke-width="0.1">
                <g id="inz-main-title.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-main-title.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="19.2">
                    <tspan id="inz-main-title.1.1.tspan.1" dy="7.5" x="0">Distribution of Education.reord by Gender</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.2" font-size="16">
        <g id="container::VP:TOPlayout.3">
          <g id="container::VP:TOPlayout::GRID.VP.497.1">
            <g id="inz-ylab.1">
              <g id="inz-ylab.1.1" transform="translate(11.52, 286.35)" stroke-width="0.1">
                <g id="inz-ylab.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-ylab.1.1.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                    <tspan id="inz-ylab.1.1.tspan.1" dy="6.5" x="0">Proportion (%)</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.3" font-size="16">
        <g id="container::VP:TOPlayout.4">
          <g id="container::VP:TOPlayout::GRID.VP.498.1">
            <g id="inz-xlab.1">
              <g id="inz-xlab.1.1" transform="translate(309, 33.52)" stroke-width="0.1">
                <g id="inz-xlab.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-xlab.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                    <tspan id="inz-xlab.1.1.tspan.1" dy="6.5" x="0">Education.reord</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.4" font-size="16">
        <g id="container::VP:TOPlayout.5">
          <g id="container::VP:TOPlayout::GRID.VP.499.1">
            <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout.1"/>
          </g>
        </g>
      </g>
      <g id="container.5" font-size="16">
        <g id="container::VP:TOPlayout.6">
          <g id="container::VP:TOPlayout::GRID.VP.499.2">
            <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout.2">
              <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500.1">
                <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500::GRID.VP.489.1">
                  <g id="inz-leg-layout.1">
                    <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500::GRID.VP.489::GRID.VP.490.1">
                      <g id="GRID.cellGrob.317.1">
                        <g id="inz-leg-title.1">
                          <g id="inz-leg-title.1.1" transform="translate(629.7, 317.15)" stroke-width="0.1">
                            <g id="inz-leg-title.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-title.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-title.1.1.tspan.1" dy="6.5" x="0">Gender</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500::GRID.VP.489::GRID.VP.491.1">
                      <g id="GRID.cellGrob.318.1">
                        <g id="inz-leg-pt-1.1">
                          <use id="inz-leg-pt-1.1.1" href="#gridSVG.pch22" x="606.2" y="281.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(230,159,0)" stroke-width="1.25" fill="rgb(230,159,0)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500::GRID.VP.489::GRID.VP.492.1">
                      <g id="GRID.cellGrob.319.1">
                        <g id="inz-leg-txt-1.1">
                          <g id="inz-leg-txt-1.1.1" transform="translate(625.4, 281.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-1.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-1.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-1.1.1.tspan.1" dy="6.5" x="0">female</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500::GRID.VP.489::GRID.VP.493.1">
                      <g id="GRID.cellGrob.320.1">
                        <g id="inz-leg-pt-2.1">
                          <use id="inz-leg-pt-2.1.1" href="#gridSVG.pch22" x="606.2" y="255.55" width="16" height="16" transform=" translate(-8,-8)" stroke="rgb(86,170,233)" stroke-width="1.25" fill="rgb(86,170,233)" stroke-opacity="1" fill-opacity="1" font-size="16"/>
                        </g>
                      </g>
                    </g>
                    <g id="container::VP:TOPlayout::GRID.VP.499::VP:LEGlayout::GRID.VP.500::GRID.VP.489::GRID.VP.494.1">
                      <g id="GRID.cellGrob.321.1">
                        <g id="inz-leg-txt-2.1">
                          <g id="inz-leg-txt-2.1.1" transform="translate(625.4, 255.55)" stroke-width="0.1">
                            <g id="inz-leg-txt-2.1.1.scale" transform="scale(1, -1)">
                              <text x="0" y="0" id="inz-leg-txt-2.1.1.text" text-anchor="start" fill="rgb(0,0,0)" fill-opacity="1" font-size="16">
                                <tspan id="inz-leg-txt-2.1.1.tspan.1" dy="6.5" x="0">male</tspan>
                              </text>
                            </g>
                          </g>
                        </g>
                      </g>
                    </g>
                  </g>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.6" font-size="16">
        <g id="container::VP:TOPlayout.7">
          <g id="container::VP:TOPlayout::GRID.VP.501.1">
            <g id="inz-main-sub-bottom.1">
              <g id="inz-main-sub-bottom.1.1" transform="translate(309, 11)" stroke-width="0.1">
                <g id="inz-main-sub-bottom.1.1.scale" transform="scale(1, -1)">
                  <text x="0" y="0" id="inz-main-sub-bottom.1.1.text" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1" font-size="12.8">
                    <tspan id="inz-main-sub-bottom.1.1.tspan.1" dy="5.5" x="0">285 missing values (285 in Education.reord)</tspan>
                  </text>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
      <g id="container.7" font-size="16">
        <g id="container::VP:TOPlayout.8">
          <g id="container::VP:TOPlayout::GRID.VP.502.1">
            <g id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout.1"/>
          </g>
        </g>
      </g>
      <g id="container.8" font-size="16">
        <g id="container::VP:TOPlayout.9">
          <g id="container::VP:TOPlayout::GRID.VP.502.2">
            <g id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout.2">
              <g id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout::GRID.VP.503.1" font-size="19.2">
                <g id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout::GRID.VP.503::GRID.VP.504.1">
                  <defs>
                    <clipPath id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout::GRID.VP.503::GRID.VP.504::VP:locate.these.points.1.clipPath">
                      <rect x="69.72" y="100.43" width="478.56" height="371.85" fill="none" stroke="none"/>
                    </clipPath>
                  </defs>
                  <g id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout::GRID.VP.503::GRID.VP.504::VP:locate.these.points.1" clip-path="url(#container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout::GRID.VP.503::GRID.VP.504::VP:locate.these.points.1.clipPath)">
                    <g id="inz-plot-bg.1.1.1">
                      <rect id="inz-plot-bg.1.1.1.1" x="69.72" y="100.43" width="478.56" height="371.85" transform="" fill="rgb(238,238,238)" stroke-dasharray="none" fill-opacity="1"/>
                    </g>
                    <g id="inz-y-grid.1.1.1">
                      <polyline id="inz-y-grid.1.1.1.1" points="69.72,100.43 548.28,100.43" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.2" points="69.72,201.53 548.28,201.53" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.3" points="69.72,302.63 548.28,302.63" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.4" points="69.72,403.74 548.28,403.74" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                      <polyline id="inz-y-grid.1.1.1.5" points="69.72,504.84 548.28,504.84" stroke="rgb(255,255,255)" stroke-width="1" stroke-opacity="1" fill="none"/>
                    </g>
                    <g id="inz-BAR.1.1.1">
                      <polygon id="inz-BAR.1.1.1.1" points="74.51,100.43 74.51,160.4 117.15,160.4 117.15,100.43" fill="rgb(230,159,0)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.2" points="117.15,100.43 117.15,167.64 160.65,167.64 160.65,100.43" fill="rgb(86,170,233)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.3" points="170.22,100.43 170.22,180.4 212.87,180.4 212.87,100.43" fill="rgb(230,159,0)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.4" points="212.87,100.43 212.87,243.26 256.36,243.26 256.36,100.43" fill="rgb(86,170,233)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.5" points="265.93,100.43 265.93,291.78 308.58,291.78 308.58,100.43" fill="rgb(230,159,0)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.6" points="308.58,100.43 308.58,285.27 352.07,285.27 352.07,100.43" fill="rgb(86,170,233)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.7" points="361.64,100.43 361.64,426.01 404.29,426.01 404.29,100.43" fill="rgb(230,159,0)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.8" points="404.29,100.43 404.29,422.5 447.78,422.5 447.78,100.43" fill="rgb(86,170,233)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.9" points="457.35,100.43 457.35,454.57 500,454.57 500,100.43" fill="rgb(230,159,0)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                      <polygon id="inz-BAR.1.1.1.10" points="500,100.43 500,394.49 543.49,394.49 543.49,100.43" fill="rgb(86,170,233)" stroke="rgb(0,0,0)" stroke-width="1" stroke-opacity="1" fill-opacity="1"/>
                    </g>
                  </g>
                  <g id="inz-rect-tp.1.1.1">
                    <rect id="inz-rect-tp.1.1.1.1" x="69.72" y="100.43" width="478.56" height="371.85" transform="" fill="none" fill-opacity="0"/>
                  </g>
                  <g id="container::VP:TOPlayout::GRID.VP.502::VP:PLOTlayout::GRID.VP.503::GRID.VP.504::GRID.VP.505.1">
                    <g id="inz-labelText.1">
                      <g id="inz-labelText.1.1" transform="translate(117.58, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.1.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.1.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.1.tspan.1" dy="10" x="0">8thGrade</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.2" transform="translate(213.29, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.2.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.2.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.2.tspan.1" dy="10" x="0">9_11thGrade</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.3" transform="translate(309, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.3.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.3.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.3.tspan.1" dy="10" x="0">HighSchool</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.4" transform="translate(404.71, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.4.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.4.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.4.tspan.1" dy="10" x="0">SomeCollege</tspan>
                          </text>
                        </g>
                      </g>
                      <g id="inz-labelText.1.5" transform="translate(500.42, 98.54)" stroke-width="0.1">
                        <g id="inz-labelText.1.5.scale" transform="scale(1, -1)">
                          <text x="0" y="0" id="inz-labelText.1.5.text" transform="rotate(-30)" text-anchor="end" fill="rgb(0,0,0)" fill-opacity="1" font-size="10.24">
                            <tspan id="inz-labelText.1.5.tspan.1" dy="10" x="0">CollegeGrad</tspan>
                          </text>
                        </g>
                      </g>
                    </g>
                    <g id="inz-yaxis-left.1.1.1" font-size="12.8">
                      <g id="major.1">
                        <polyline id="major.1.1" points="69.72,100.43 69.72,454.29" fill="none"/>
                      </g>
                      <g id="ticks.1">
                        <polyline id="ticks.1.1" points="69.72,100.43 58.2,100.43" fill="none"/>
                        <polyline id="ticks.1.2" points="69.72,150.98 58.2,150.98" fill="none"/>
                        <polyline id="ticks.1.3" points="69.72,201.53 58.2,201.53" fill="none"/>
                        <polyline id="ticks.1.4" points="69.72,252.08 58.2,252.08" fill="none"/>
                        <polyline id="ticks.1.5" points="69.72,302.63 58.2,302.63" fill="none"/>
                        <polyline id="ticks.1.6" points="69.72,353.18 58.2,353.18" fill="none"/>
                        <polyline id="ticks.1.7" points="69.72,403.74 58.2,403.74" fill="none"/>
                        <polyline id="ticks.1.8" points="69.72,454.29 58.2,454.29" fill="none"/>
                      </g>
                      <g id="labels.1">
                        <g id="labels.1.1" transform="translate(46.68, 100.43)" stroke-width="0.1">
                          <g id="labels.1.1.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.1.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.1.tspan.1" dy="0" x="0">0</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.2" transform="translate(46.68, 150.98)" stroke-width="0.1">
                          <g id="labels.1.2.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.2.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.2.tspan.1" dy="0" x="0">5</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.3" transform="translate(46.68, 201.53)" stroke-width="0.1">
                          <g id="labels.1.3.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.3.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.3.tspan.1" dy="0" x="0">10</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.4" transform="translate(46.68, 252.08)" stroke-width="0.1">
                          <g id="labels.1.4.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.4.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.4.tspan.1" dy="0" x="0">15</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.5" transform="translate(46.68, 302.63)" stroke-width="0.1">
                          <g id="labels.1.5.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.5.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.5.tspan.1" dy="0" x="0">20</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.6" transform="translate(46.68, 353.18)" stroke-width="0.1">
                          <g id="labels.1.6.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.6.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.6.tspan.1" dy="0" x="0">25</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.7" transform="translate(46.68, 403.74)" stroke-width="0.1">
                          <g id="labels.1.7.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.7.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.7.tspan.1" dy="0" x="0">30</tspan>
                            </text>
                          </g>
                        </g>
                        <g id="labels.1.8" transform="translate(46.68, 454.29)" stroke-width="0.1">
                          <g id="labels.1.8.scale" transform="scale(1, -1)">
                            <text x="0" y="0" id="labels.1.8.text" transform="rotate(-90)" text-anchor="middle" fill="rgb(0,0,0)" fill-opacity="1">
                              <tspan id="labels.1.8.tspan.1" dy="0" x="0">35</tspan>
                            </text>
                          </g>
                        </g>
                      </g>
                    </g>
                    <g id="inz-yaxis-right.1.1.1" font-size="12.8">
                      <g id="major.2">
                        <polyline id="major.2.1" points="548.28,100.43 548.28,454.29" fill="none"/>
                      </g>
                      <g id="ticks.2">
                        <polyline id="ticks.2.1" points="548.28,100.43 559.8,100.43" fill="none"/>
                        <polyline id="ticks.2.2" points="548.28,150.98 559.8,150.98" fill="none"/>
                        <polyline id="ticks.2.3" points="548.28,201.53 559.8,201.53" fill="none"/>
                        <polyline id="ticks.2.4" points="548.28,252.08 559.8,252.08" fill="none"/>
                        <polyline id="ticks.2.5" points="548.28,302.63 559.8,302.63" fill="none"/>
                        <polyline id="ticks.2.6" points="548.28,353.18 559.8,353.18" fill="none"/>
                        <polyline id="ticks.2.7" points="548.28,403.74 559.8,403.74" fill="none"/>
                        <polyline id="ticks.2.8" points="548.28,454.29 559.8,454.29" fill="none"/>
                      </g>
                    </g>
                  </g>
                  <script type="application/ecmascript" id="linkedJSONdata"><![CDATA[
var chart = {"type":["bar"],"data":[{"var1":"female","var2":"8thGrade","pct":5.93,"counts":21},{"var1":"male","var2":"8thGrade","pct":6.65,"counts":24},{"var1":"female","var2":"9_11thGrade","pct":7.91,"counts":28},{"var1":"male","var2":"9_11thGrade","pct":14.13,"counts":51},{"var1":"female","var2":"HighSchool","pct":18.93,"counts":67},{"var1":"male","var2":"HighSchool","pct":18.28,"counts":66},{"var1":"female","var2":"SomeCollege","pct":32.2,"counts":114},{"var1":"male","var2":"SomeCollege","pct":31.86,"counts":115},{"var1":"female","var2":"CollegeGrad","pct":35.03,"counts":124},{"var1":"male","var2":"CollegeGrad","pct":29.09,"counts":105}],"colorMatch":[null],"colCounts":["Col N","0.0629","0.1105","0.186","0.3203","0.3203","1"],"group":[2],"order":{}};
]]></script>
                </g>
              </g>
            </g>
          </g>
        </g>
      </g>
    </g>
  </g>
</svg> 

        <div class = "control" id="control">
          <button type="button" class="btn btn-info" onclick="reset()" id="reset">
            <span class="glyphicon glyphicon-refresh"> </span> Reset </button>
          <button type="button" class="btn btn-info" onclick="showTable()" id="viewTable">
            <span class="glyphicon glyphicon-list-alt"> </span> Table </button>
        </div>
    </div>

    <div class = "tbl-div">
<table id="table" class="table table-condensed table-hover" cellspacing="0">
<caption>Table of Counts and Proportions</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> 8thGrade </th>
   <th style="text-align:center;"> 9_11thGrade </th>
   <th style="text-align:center;"> HighSchool </th>
   <th style="text-align:center;"> SomeCollege </th>
   <th style="text-align:center;"> CollegeGrad </th>
   <th style="text-align:center;"> Total </th>
   <th style="text-align:center;"> Row N </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> female </td>
   <td style="text-align:center;"> 0.0593 </td>
   <td style="text-align:center;"> 0.0791 </td>
   <td style="text-align:center;"> 0.1893 </td>
   <td style="text-align:center;"> 0.322 </td>
   <td style="text-align:center;"> 0.3503 </td>
   <td style="text-align:center;"> 1.0000 </td>
   <td style="text-align:center;"> 354 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> male </td>
   <td style="text-align:center;"> 0.0665 </td>
   <td style="text-align:center;"> 0.1413 </td>
   <td style="text-align:center;"> 0.1828 </td>
   <td style="text-align:center;"> 0.3186 </td>
   <td style="text-align:center;"> 0.2909 </td>
   <td style="text-align:center;"> 1.0000 </td>
   <td style="text-align:center;"> 361 </td>
  </tr>
</tbody>
</table>

      </div>
  </div>

    <script defer type = "text/javascript">
// COMMON FUNCTIONS FOR SINGLE PANEL PLOTS:
/* set svg with no width, height */
var svg = document.getElementsByTagName('svg')[0];
svg.removeAttribute('height');
svg.removeAttribute('width');

var data = chart.data;

// make tables not go wide when there's only 1 column
if (chart.type !== "bar") {
  var ncol = $("#table thead tr th").length;
  if (ncol < 3) {
    $('#table').css('width', '50%');
  } else if (ncol <= 4) {
    $('#table').css('width', '75%');
  } else {
    $('#table').css('width', '100%');
  }
} else {
  $('#table').css('width', '100%');
}

//table functions:
// insert an x-header:
insertXHeader = function() {
  var xrow = table.insertRow(0),
      xhead = xrow.insertCell(0);
  xhead.setAttribute('class', 'headings');
  xhead.innerHTML = document.getElementsByTagName('tspan')[2].innerHTML;
  xhead.colSpan = ncol;
};

// creating a y-header:
insertYHeader = function() {
  var yHeading = document.getElementsByTagName('th')[0];
  yHeading.innerHTML = document.getElementsByTagName('tspan')[3].innerHTML;
  yHeading.setAttribute('class',' headings');
}

//create buttons:
button = function(name) {
  var button = document.createElement('button');
  button.setAttribute("type", "button");
  button.setAttribute("class","btn btn-primary hidden " + name);
  button.innerHTML = "Show " + name;
  button.setAttribute("onclick", "change" + name + "()");
  button.setAttribute('id', 'Button' + name);
  document.getElementById('control').appendChild(button);
};

// TODO: revise further
getGrob = function(chartType) {
  var polygon = document.getElementsByTagName('polygon');
  if (chartType == 'hist'){
    var p = polygon[2];
  } else if (chartType == 'bar'){
    var p = polygon[polygon.length-1];
  } else {
    var p = polygon[0]; //hexbin, bp-stacked.
  }
  var id = p.getAttribute('id');
  var Grob = id.substring(0, id.lastIndexOf('.'));
  return(Grob);
}

//FUNCTIONS FOR BOXPLOTS
boxMe = function(levelNo) {

  var polygonBoxes = document.querySelectorAll('g[id^="inz-box."]')
  var boxLines = document.querySelectorAll('g[id^="inz-box-line."]')

  for (i = 1; i <= levelNo; i++) { //separate boxes for each plot
    var polygonBox = polygonBoxes[i-1].children;
    var boxLine = boxLines[i-1].children;
    for (j=0; j < 2; j++) {
      polygonBox[j].setAttribute('class', 'box-' + i);
      boxLine[j].setAttribute('class', 'box-' + i);
    }
    boxLabelSet(i, 0, 1, 0,'LQ');
    boxLabelSet(i, 1, 2, 2, 'UQ');
    boxLabelSet(i, 1, 0, 1, 'Median');
    boxLabelSet(i, 1, 0, 3, 'Min');
    boxLabelSet(i, 2, 1, 4, 'Max');
  };

  //Box Plot interactions:
  for (j = 1; j <= levelNo; j++) {
  var box = document.getElementsByClassName('box-' + j);
  for (i = 0; i < box.length; i++) {
    box[i].setAttribute('onmouseover', 'fillBox(' + j + ')');
    box[i].setAttribute('onmouseout', 'normalBox(' + j + ')');
    box[i].setAttribute('onclick', 'showBox(' + j + ')');
    }
  }

  fillBox = function(j) {
    d3.selectAll('.box-' + j)
      .classed('fillBox', true);
  };

  normalBox = function(j) {
    d3.selectAll('.box-' + j)
      .classed('fillBox', false);
    };

  showBox = function(j) {
    var boxData = d3.selectAll('.boxData-' + j);
      boxData.classed('hidden', !boxData.classed('hidden'));
  }
}

//functions to create boxLabels:
boxLabel = function(i, textinput, panel, x, y) {
var boxLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
  boxLabel.setAttribute('class', 'label boxData-' + i + ' hidden'); //hidden
  boxLabel.setAttributeNS(null, 'transform', 'translate(' + Number(x) + ',' + (Number(y) + 2) + ') scale(1, -1)');
  boxLabel.setAttributeNS(null, 'id', textinput);

  var textNode = document.createTextNode(textinput);
  boxLabel.appendChild(textNode);
  //var panel = document.getElementById('inz-' + tag + '.1.1.' + i + ".1");
  panel.appendChild(boxLabel);
};

boxLabelSet = function(i, p, r, q, textinput) {
  if (textinput == "Min" ||  textinput == "Max") {
    var line = document.getElementById('inz-box-line.1.1.' + i  + '.1.' + p); //i is levelNo.
    // p will either be 1 or 2 -> 1 = minLine, 2 = maxLine
    line.setAttribute('class', 'box-' + i);
    var boxPoints = line.getAttribute('points').split(" ")[r].split(",");
    var panel = line.parentNode;
  } else {
    var box = document.getElementsByClassName('box-' + i)[p];
    // boxplot split into two boxes - lowerbox (p = 0) and upperbox (p = 1)
    var boxPoints = box.getAttribute('points').split(" ")[r].split(",");
    var panel = box.parentNode;
  }
  x = boxPoints[0];
  y = boxPoints[1];

  if (textinput == "Median") {
    // move median label below the box plot
   y = boxPoints[1] - 11;
  }
  if (levelNo == 1) {
    text = textinput + ": " + chart.boxData[q].quantiles;
  } else {
    text = textinput + ": " + chart.boxData[i-1][q].quantiles;
  }
  // this is associated with the boxData imported from R.
  //q = 0 (LQ), 1 (UQ), 2 (Median), 3 (Min), 4 (Max)
  boxLabel(i, text, panel, x, y);
};

//FUNCTIONS FOR INTERACTING WITH LEGEND
// hover on a legend group:
show = function(i) {
  var keyText = document.getElementById('inz-leg-txt-' + i + '.1.1.tspan.1');
  var key = document.getElementById('inz-leg-pt-' + i + '.1.1');
  if (key.getAttribute("fill") !== "none") {
        keyText.setAttribute('fill', key.getAttribute('fill'));
    } else {
        keyText.setAttribute('fill', key.getAttribute('stroke'));
    }
  keyText.setAttribute('class', 'show');
  key.setAttribute('class', 'show');
};

//hover out:
out = function(i) {
  var keyText = document.getElementById('inz-leg-txt-' + i + '.1.1.tspan.1');
  var key = document.getElementById('inz-leg-pt-' + i + '.1.1');
  keyText.setAttribute('class', 'out keyText');
  key.setAttribute('class', 'out');
};

//FUNCTIONS FOR HIGHLIGHTING tabs/cells:
returnTabSelection = function(lp, data) {
  data.classList.add('tabSelect');
  data.style.backgroundColor = "rgba(" + lp + ",0.5)";
}

resetTabSelection = function(data) {
  data.classList.remove('tabSelect');
  data.style.backgroundColor = "white";
}

// Brush events:
function brushend() {
  if (!d3.event.selection) {
    d3.select(".selection")
      .style("display", "none");
  }
}

function brushstart() {
  d3.select(".selection")
    .style("display", null);
}
    </script>

    <script defer type = "text/javascript">
// for bar plots: stacked, two-way and single
// set up table:
var table = document.getElementById('table'),
    tr = table.getElementsByTagName('tr'),
    ncol = tr[0].childElementCount, //no of columns
    td = table.getElementsByTagName('td'),
    cellNo = td.length, //cell no.
    nrow = table.rows.length, //no. of rows
    colorMatch = chart.colorMatch,
    colCounts = chart.colCounts,
    number = data.length,
    count = number + 1;

if (chart.type == "bp-stacked") {
  // labelling rows:
  for (var i = 1; i < nrow; i ++) {
    if(i == nrow-2) { // last two rows are the rows containing totals and counts
      tr[i].setAttribute('class', 'tc');
    } else if (i == nrow-1) {
      tr[i].setAttribute('class', 'countRow');
    } else {
      tr[i].setAttribute('class', 'row' + i);
    }
  };

  //finding no. of rows, and labelling
  for (var j = 1; j <ncol; j++) {
    for (var i = 1; i <= cellNo; i ++) {
      if (i % ncol == 1){
        td[i-1].setAttribute('id', 'yGroup' + ((i-1)/ncol + 1));
        td[i-1].setAttribute('class', 'yGroup');
      } else if (document.getElementsByClassName('countRow')[0].contains(td[i-1])){
        td[i-1].setAttribute('id', 'counts' + ((i-1)%ncol));
        td[i-1].innerHTML = Number(td[i-1].innerHTML);
      } else if (document.getElementsByClassName('tc')[0].contains(td[i-1])) {
        td[i-1].setAttribute('id', 'tc' +((i-1)%ncol));
        td[i-1].setAttribute('class', 'tc');
      } else {
        td[i-1].setAttribute('id',  'td' + i);
        td[i-1].setAttribute('class', 'td' + chart.order[i-Math.ceil(i/ncol)-1]);
      }
    }
  };

} else {
  //defining table elements
  d3.selectAll('tr')
    .attr('id', function(d, i) { return ('tr' + i) });

  //finding no. of rows, and labelling
  for (var i = 1; i <= cellNo; i++) {
      if (i % ncol === 0) {
          td[i - 1].setAttribute('id', 'tc' + i / ncol);
          td[i - 1].setAttribute('class', 'tc');
      } else if (i % ncol === 1) {
          td[i - 1].setAttribute('id', 'yGroup' + ((i - 1) / ncol + 1));
          td[i - 1].setAttribute('class', 'yGroup');
      } else if (data[0].var1 !== undefined) {
          td[i - 1].setAttribute('id', 'td' + (((i - (i % ncol)) / ncol + 1) + ((nrow - 1) * (i % ncol - 2))));
      } else if (i < ncol) {
          td[i - 1].setAttribute('class', 'td' + (i - 1));
      } else {
          td[i - 1].setAttribute('class', 'td' + ((i - 2) % ncol + 1));
      }
    }
}

//x-header:
insertXHeader();

if (data[0].var1 !== undefined || data[0].Var1 !== undefined) {
  //Finding the sum of countsTab:
  countsTab = [];
  if (chart.type == "bar") {
    for (i = 1; i <= cellNo / ncol; i++) {
        var tc = document.getElementById('tc' + i);
        countsTab[i-1] = Number(tc.innerHTML);
    }
  } else {
    for (j = 1; j < ncol; j++) {
        var totalCounts = document.getElementById('counts' + j); //counts for each group
        countsTab[j-1] = Number(totalCounts.innerHTML);
    }
  }

  //global sum variable
  sum = countsTab.reduce(function(a, b) { return a + b; }, 0);

  //y heading:
  insertYHeader();

  if (chart.type == "bar") {
    //Summation row  - should move this to R?
    var lastRow = table.insertRow(nrow+1);
    lastRow.setAttribute('class', 'totalRow');

    for (i = 1; i <= ncol; i ++) {
      var cell = lastRow.insertCell(i-1);
      cell.id = "totalCell" + (i-1);
      cell.setAttribute("class", "totalCell");
      //fill in column totals:
      cell.innerHTML = colCounts[i-1];
    }

    var sumCell = document.getElementById('totalCell' + (ncol-1));
    sumCell.innerHTML = "N = " + sum;
    var totalCell = document.getElementById('totalCell' + (ncol-2));
  }

  //insert buttons and conversion functions:
  button("Percentage");
  button("Count");

}

//Conversion to percentages:
changePercentage = function() {

  d3.select(".Count")
    .classed('dark', false);
  d3.select('.Percentage')
    .classed('dark', true);

  if (chart.type == "bp-stacked") { //stacked
    for (var i = 1; i <= cellNo; i++) {
        var td = document.getElementById('td' + i);
        var total = document.getElementById('tc' + ((i-1)%ncol));
        var countsCol = document.getElementById('counts' + ((i-1)%ncol));
        if (td !== null) {
          if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') == -1)) { // change proportion to percentages
            td.innerHTML = (td.innerHTML*100).toFixed(2) + "%";
            total.innerHTML = "100.00%"; // this is a bit iffy. Fixed at 100.
            countsCol.innerHTML = countsCol.innerHTML;
          } else if (td.innerHTML.indexOf('%') >= 0) { // remain as percentages
            td.innerHTML = td.innerHTML;
            total.innerHTML = total.innerHTML;
            countsCol.innerHTML = countsCol.innerHTML;
          } else { // change counts to percentages
            td.innerHTML = (Number(td.innerHTML)/countsTab[((i-1)%ncol)-1]*100).toFixed(2) + "%";
            total.innerHTML = "100.00%";
            countsCol.innerHTML = countsTab[((i-1)%ncol)-1];
          }
            document.getElementById('yGroup' + (nrow - 1)).innerHTML = "Col N"; // change from 'Total %' to 'Col N'
          }
        }
      } else { // two way tables
        //for the column sums:
        for (i = 1; i < ncol-2; i++) {
          var tCol = document.getElementById('totalCell' + i);
          if ((tCol.innerHTML.indexOf('%') == -1) && (tCol.innerHTML.indexOf(".") >=0)) {
            tCol.innerHTML = (Number(tCol.innerHTML)*100).toFixed(2) + '%';
          } else if (tCol.innerHTML.indexOf('%') >= 0) {
            tCol.innerHTML = tCol.innerHTML;
          } else {
            tCol.innerHTML =(Number(tCol.innerHTML)/sum * 100).toFixed(2) + '%';
          }
        }

        //for all other data:
        for (j = 1; j <= cellNo/ncol; j++) {
          var tr = document.getElementById('tr' + j);
        for (i = 1; i <= cellNo - 2*(nrow-1); i ++) {
            var td = document.getElementById('td' + i);
            if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') == -1)) {
            td.innerHTML = (td.innerHTML*100).toFixed(2) + "%";
          } else if (td.innerHTML.indexOf('%') >= 0) {
            td.innerHTML = td.innerHTML;
          } else {
              if(tr.contains(document.getElementById('tc' + j)) && tr.contains(document.getElementById('td' + i))) {
              td.innerHTML = (Number(td.innerHTML)/countsTab[j-1] * 100).toFixed(2) + '%';
              var tc = document.getElementById('tc' + j);
              tc.innerHTML = countsTab[j-1];
              }
            }
          }
        }
      document.getElementsByTagName('th')[(ncol-1)].innerHTML = "Row N";
      totalCell.innerHTML = "100.00%";
      sumCell.innerHTML = "N = " + sum;
    }
};

//Conversion to counts:
changeCount = function() {

    d3.select(".Count")
      .classed('dark', true);
    d3.select('.Percentage')
      .classed('dark', false);

    if (chart.type == "bp-stacked") { // stacked
      for(i = 1; i <= cellNo; i++) {
          var td = document.getElementById('td' + i);
          var total = document.getElementById('tc' + ((i-1)%ncol)); // by columns
          var countsCol = document.getElementById('counts' + ((i-1)%ncol));
          if (td !== null && total !== undefined) {
          if (td.innerHTML.indexOf('%') >= 0) { // convert percentage to counts
          td.innerHTML = Math.round(Number(td.innerHTML.substring(0,td.innerHTML.lastIndexOf('%')))/100 * countsTab[((i-1)%ncol)-1]);
          countsCol.innerHTML = (countsTab[((i-1)%ncol)-1]/sum*100).toFixed(2) + "%";
          total.innerHTML = Math.round(countsTab[((i-1)%ncol)-1]);
        } else if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') >= -1)){ //converts proportions to counts
          td.innerHTML = Math.round(Number(td.innerHTML) * countsTab[((i-1)%ncol)-1]);
          countsCol.innerHTML = (countsTab[((i-1)%ncol)-1]/sum*100).toFixed(2) + "%";
          total.innerHTML = Math.round(countsTab[((i-1)%ncol)-1]);
        } else { // remain as counts (if already converted to counts)
          td.innerHTML = td.innerHTML;
          total.innerHTML = total.innerHTML;
        }
      }
    }
      document.getElementById('yGroup' + (nrow - 1)).innerHTML = "Total %";
    } else { // two way tables
      //for the column sums:
      for (i = 1; i < ncol-2; i++) {
        var tCol = document.getElementById('totalCell' + i);
        if ((tCol.innerHTML.indexOf('%') == -1) && (tCol.innerHTML.indexOf(".") >=0)) {
          tCol.innerHTML = Math.round(Number(tCol.innerHTML)*sum);
        } else if (tCol.innerHTML.indexOf('%') >= 0) {
          tCol.innerHTML = Math.round(Number(tCol.innerHTML.substring(0,tCol.innerHTML.lastIndexOf('%')))/100 * sum);
        } else {
          tCol.innerHTML = tCol.innerHTML;
        }
      }

    //for all other data:
    for (j = 1; j <= cellNo/ncol; j ++) {
      var tr = document.getElementById('tr' + j);
      for(i = 1; i <= cellNo - 2*(nrow-1); i++) {
    if(tr.contains(document.getElementById('tc' + j)) && tr.contains(document.getElementById('td' + i))) {
          var td = document.getElementById('td' + i);
          var tc = document.getElementById('tc' + j);
          if (td.innerHTML.indexOf('%') >= 0){
          td.innerHTML = Math.round(Number(td.innerHTML.substring(0,td.innerHTML.lastIndexOf('%')))/100 * countsTab[j-1]);
          tc.innerHTML = (countsTab[j-1]/sum*100).toFixed(2) + "%";
        } else if ((td.innerHTML.indexOf(".") >= 0) && (td.innerHTML.indexOf('%') == -1)){
          td.innerHTML = Math.round(Number(td.innerHTML) * countsTab[j-1]);
          tc.innerHTML = (countsTab[j-1]/sum*100).toFixed(2) + "%";
        } else {
          td.innerHTML = td.innerHTML;
          tc.innerHTML = tc.innerHTML;
        }
      }
    }
  }
  document.getElementsByTagName('th')[(ncol-1)].innerHTML = "Row N %";
  totalCell.innerHTML = "N = " + sum;
  sumCell.innerHTML = "100.00%";
  }
};

//initialize DataTable:
var table = $('#table').DataTable({
    "colReorder": true,
    //disable ordering and sorting
    "ordering": false,
    "aaSorting": []
});

//viewTable button:
showTable = function() {
  $('#table_wrapper').toggleClass('hidden');
  $('.Percentage').toggleClass('hidden');
  $('.Count').toggleClass('hidden');
};

// obtaining values from SVG file:

screenBars = function(colorMatch) {

  var Grob = getGrob('bar');
  //if the bar plot is colored - has additional bars and polylines to hide!
  if (colorMatch[0] !== null) {
    var p = document.getElementsByTagName('polygon');
    // if stacked:
    if (chart.type == "bp-stacked") {
      var Grob = getGrob('bp-stacked');
      for (i = 0; i < p.length; i++) {
        if (p[i].id.indexOf(Grob) >= 0) {
          p[i].classList.add('bar');
        } else {
          p[i].classList.add('hidden');
        }
      };
    } else {
      for (i = 0; i < p.length; i++) {
        if (colorMatch[i] == 1) {
          p[i].id = Grob + "." + (i/(number-1));
          p[i].classList.add('bar');
        } else {
          p[i].classList.add('hidden');
      }
    }
  }

  //Hiding polylines:
    var barLines = document.getElementById('inz-bar-line.1.1.1');
    d3.select(barLines).selectAll('polyline')
      .classed("hidden", true);
    var bars = d3.select('svg').selectAll('.bar');

  } else {
    var panel = document.getElementById(Grob),
        bars = d3.select(panel).selectAll('polygon');
  }
  return(bars);
}

//tooltip:
var tooltip = d3.select('body').append('div')
              .attr('class', 'tooltip')
              .attr('id', 'tooltip')
              .style('width', '100px')
              .style('min-height', '40px')
              .style('visibility', 'hidden');

// link bars with tooltips and table:
makeTooltips = function(bars, data) {

  bars.data(data)
      .attr('class', 'bar')
      .on('mouseover', function(d){ var el = d3.select(this),
                                        coords = el.attr('points'),
                                        small = coords.split(" ")[0],
                                        sx = Number(small.split(",")[0]),
                                        coordsxy = coords.split(" ")[2],
                                        x = Number(coordsxy.split(",")[0]),
                                        xx = x + (sx-x)/2 - 50,
                                        y = Number(coordsxy.split(",")[1]) + 60;

                                    //translate to html co-ordinates
                                    var tm = this.getScreenCTM()
                                                     .translate(+ xx, + y);

                                    var tooltip = d3.select("#tooltip");
                                    tooltip.style('visibility', 'visible')
                                                .style("left", (window.pageXOffset + tm.e)  + "px")
                                                .style("top", (window.pageYOffset +tm.f)  + "px"); //position needs fixing
                                    if (data[0].var1 !== undefined) { // for 2-way tables
                                      tooltip.html("<span>" + d.var1 + ' ' + d.var2+ "<br/> " + d.pct +
                                      "%</span>" + "<br/>" + d.counts);
                                    } else if (data[0].Var1 !== undefined) { //for stacked
                                      tooltip.html("<span>" + d.Var1 + ' ' + d.Var2 + "<br> " + d.pct +
                                      "%</span>" + "<br>" +
                                      d.counts);
                                    } else {
                                      tooltip.html("<span>" + d.varx + "<br/> " + d.pct +
                                      "%</span>" + "<br/>" + d.counts);
                                    }
                                  })
      .on('mouseout', function(){tooltip.style("visibility", "hidden");})
      .on('click', function(d, i) {
        //clear rows if active:
        $(".tabSelect").removeClass("active tabSelect");
        var selected = this;
        if (chart.type == "bp-stacked") {
          for (j = 1; j <= count; j++) {
            if ((i+1) == j) {
              $(table.cell(".td" + j).nodes()).addClass("active tabSelect");
            }
          }
        } else {
          d3.selectAll('.bar')
            .attr("class", function(d, i) {
              if (this == selected) {
                if (data[0].var1 !== undefined) {
                  $(table.cell("#td" + (i + 1)).nodes()).addClass("active tabSelect");
                } else {
                  $(table.column(i + 1).nodes()).addClass('active tabSelect');
                }
                return ("bar selected");
              } else {
                return ("bar none");
              }
            });
        }
      });
}

//For one way colored plots and two-way bar plots (where a legend is made on the right)
//LEGEND INTERACTION:
intLegend = function() {
  var legendLayout = document.getElementById('inz-leg-layout.1');
  if (legendLayout) {
    if (data[0].var1 !== undefined) {
      // this is to find the no. of groups for the second variable.
      var group = chart.group[0] + 1;
    } else {
      var group = count;
    };

    //assigning mouse events:
    for (i = 1; i < group; i++) {
        var keyText = document.getElementById('inz-leg-txt-' + i + '.1.1.tspan.1');
        var key = document.getElementById('inz-leg-pt-' + i + '.1.1');

        (function (i) {
            key.addEventListener("mouseover", function () { show(i) }, false);
            key.addEventListener("mouseout", function () { out(i) }, false);
            key.addEventListener("click", function () { subset(i) }, false);

            keyText.addEventListener("mouseover", function () { show(i) }, false);
            keyText.addEventListener("mouseout", function () { out(i) }, false);
            keyText.addEventListener("click", function () { subset(i) }, false);
        })(i)
      }

  subset = function(i) {
    var j = i;
    // clear tables:
    $(".tabSelect").removeClass("active tabSelect");

      d3.selectAll('.bar')
        .attr("class", function(d, i) {
          var i = i + 1;
            if ((i == j || (i%(group-1)) == j || (i%(group-1)) == 0 && j == (group-1))) {
              if(data[0].var1 !== undefined) { // for 2-way tables
                $(table.row((i-1)%(nrow-1)).nodes()).addClass('active tabSelect');
              } else {
                $(table.column(j).nodes()).addClass('active tabSelect');
              }
              return("bar selected");
            } else {
              $(table.row((i-1)%(nrow-1)).nodes()).removeClass('active tabSelect');
              return("bar none");
            }
        });
    }
  };
}

var bars = screenBars(colorMatch);
makeTooltips(bars, data);
if (colorMatch[0] !== true) {
  intLegend();
}

 //Reset Button: attempts to bring plot back to original state
reset = function() {
  d3.selectAll('.bar')
    .attr("class", "bar");
  // reset tables:
  $(".tabSelect").removeClass("active tabSelect");
 };

var plotRegion = document.querySelectorAll('rect[id^="inz-plot-bg"]')[0];
 plotRegion.addEventListener("click", reset, false);
    </script>

  </body>

</html>
